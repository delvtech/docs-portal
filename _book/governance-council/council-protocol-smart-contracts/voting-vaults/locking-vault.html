
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Locking Vault Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="vesting-vault.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Element Documentation Portal
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="http://element.fi">
            
                    
                    Element Mainnet App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="https://testnet.element.fi">
            
                    
                    Element Testnet App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../../getting-started/faq/">
            
                <a href="../../../getting-started/faq/">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../../../getting-started/faq/earning-variable-rates.html">
            
                <a href="../../../getting-started/faq/earning-variable-rates.html">
            
                    
                    Earning Variable Rates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../../../getting-started/faq/buying-fixed-rates.html">
            
                <a href="../../../getting-started/faq/buying-fixed-rates.html">
            
                    
                    Buying Fixed Rate Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../../../getting-started/faq/providing-liquidity.html">
            
                <a href="../../../getting-started/faq/providing-liquidity.html">
            
                    
                    Providing Liquidity
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../../getting-started/glossary.html">
            
                <a href="../../../getting-started/glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Element Protocol</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../../element/concepts-overview.html">
            
                <a href="../../../element/concepts-overview.html">
            
                    
                    Concepts Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../../element/principal-tokens/">
            
                <a href="../../../element/principal-tokens/">
            
                    
                    Principal Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../../element/principal-tokens/use-cases.html">
            
                <a href="../../../element/principal-tokens/use-cases.html">
            
                    
                    Use Cases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../../element/yield-tokens/">
            
                <a href="../../../element/yield-tokens/">
            
                    
                    Yield Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../../../element/yield-tokens/use-cases.html">
            
                <a href="../../../element/yield-tokens/use-cases.html">
            
                    
                    Use Cases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../../element/market-forces.html">
            
                <a href="../../../element/market-forces.html">
            
                    
                    Market Forces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../../element/providing-liquidity.html">
            
                <a href="../../../element/providing-liquidity.html">
            
                    
                    Providing Liquidity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../../element/element-smart-contracts/">
            
                <a href="../../../element/element-smart-contracts/">
            
                    
                    Element Protocol Smart Contracts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="../../../element/element-smart-contracts/core-protocol-contracts/">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/">
            
                    
                    Core Protocol Contracts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1.1" data-path="../../../element/element-smart-contracts/core-protocol-contracts/wrapped-position.html">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/wrapped-position.html">
            
                    
                    Wrapped Position
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.2" data-path="../../../element/element-smart-contracts/core-protocol-contracts/tranche.html">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/tranche.html">
            
                    
                    Tranche
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.3" data-path="../../../element/element-smart-contracts/core-protocol-contracts/tranche-factory.html">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/tranche-factory.html">
            
                    
                    Tranche Factory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.4" data-path="../../../element/element-smart-contracts/core-protocol-contracts/interest-token.html">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/interest-token.html">
            
                    
                    Interest Token
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.5" data-path="../../../element/element-smart-contracts/core-protocol-contracts/user-proxy.html">
            
                <a href="../../../element/element-smart-contracts/core-protocol-contracts/user-proxy.html">
            
                    
                    User Proxy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="../../../element/element-smart-contracts/integration-contracts/">
            
                <a href="../../../element/element-smart-contracts/integration-contracts/">
            
                    
                    Integration Contracts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.2.1" data-path="../../../element/element-smart-contracts/integration-contracts/yearn-vault-asset-proxy.html">
            
                <a href="../../../element/element-smart-contracts/integration-contracts/yearn-vault-asset-proxy.html">
            
                    
                    Yearn Vault Asset Proxy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.3" data-path="../../../element/element-smart-contracts/custom-balancer-curve/">
            
                <a href="../../../element/element-smart-contracts/custom-balancer-curve/">
            
                    
                    Custom Balancer Curve
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.3.1" data-path="../../../element/element-smart-contracts/custom-balancer-curve/convergent-curve-pool.html">
            
                <a href="../../../element/element-smart-contracts/custom-balancer-curve/convergent-curve-pool.html">
            
                    
                    Convergent Curve Pool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.3.2" data-path="../../../element/element-smart-contracts/custom-balancer-curve/convergent-curve-pool-factory.html">
            
                <a href="../../../element/element-smart-contracts/custom-balancer-curve/convergent-curve-pool-factory.html">
            
                    
                    Convergent Curve Pool Factory
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Developers</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../../developers/public-releases.html">
            
                <a href="../../../developers/public-releases.html">
            
                    
                    Public Release Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <a target="_blank" href="https://github.com/element-fi/elf-sdk">
            
                    
                    Element SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <a target="_blank" href="https://github.com/element-fi/elf-deploy">
            
                    
                    Deployment Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../../../developers/security/">
            
                <a href="../../../developers/security/">
            
                    
                    Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" >
            
                <a target="_blank" href="https://immunefi.com/bounty/elementfinance/">
            
                    
                    Immunefi Program
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="../../../developers/security/admin-keys.html">
            
                <a href="../../../developers/security/admin-keys.html">
            
                    
                    Admin Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="../../../developers/security/oracles.html">
            
                <a href="../../../developers/security/oracles.html">
            
                    
                    Oracles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" >
            
                <a target="_blank" href="https://github.com/element-fi">
            
                    
                    Github
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" >
            
                <a target="_blank" href="https://paper.element.fi">
            
                    
                    Construction Paper
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Governance (Council)</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../">
            
                <a href="../">
            
                    
                    Council Protocol Smart Contracts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../core-voting.html">
            
                <a href="../core-voting.html">
            
                    
                    Core Voting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="./">
            
                <a href="./">
            
                    
                    Voting Vaults
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="5.1.2.1" data-path="locking-vault.html">
            
                <a href="locking-vault.html">
            
                    
                    Locking Vault
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.2" data-path="vesting-vault.html">
            
                <a href="vesting-vault.html">
            
                    
                    Vesting Vault
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.3" data-path="governance-steering-council-gsc-vault.html">
            
                <a href="governance-steering-council-gsc-vault.html">
            
                    
                    Governance Steering Council (GSC) Vault
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../timelock.html">
            
                <a href="../timelock.html">
            
                    
                    Timelock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="../treasury.html">
            
                <a href="../treasury.html">
            
                    
                    Treasury
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="../spender.html">
            
                <a href="../spender.html">
            
                    
                    Spender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6" data-path="../optimistic-grants.html">
            
                <a href="../optimistic-grants.html">
            
                    
                    Optimistic Grants
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7" data-path="../optimistic-rewards.html">
            
                <a href="../optimistic-rewards.html">
            
                    
                    Optimistic Rewards
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8" data-path="../simple-proxy.html">
            
                <a href="../simple-proxy.html">
            
                    
                    Simple Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9" data-path="../storage.html">
            
                <a href="../storage.html">
            
                    
                    Storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.10" data-path="../history.html">
            
                <a href="../history.html">
            
                    
                    History
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" >
            
                <a target="_blank" href="https://github.com/element-fi/council/tree/main/audits">
            
                    
                    Audits
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Community</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <a target="_blank" href="https://discord.com/invite/8JnDyXJJWh">
            
                    
                    Discord
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <a target="_blank" href="https://medium.com/element-finance">
            
                    
                    Medium
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" >
            
                <a target="_blank" href="https://twitter.com/element/_fi">
            
                    
                    Twitter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" >
            
                <a target="_blank" href="https://t.me/elementfinance">
            
                    
                    Telegram Announcements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                <a target="_blank" href="https://www.youtube.com/channel/UCwxX4xrw-AZF/_7dB7gVMaSw">
            
                    
                    Youtube (Community Calls and Video Guides)
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >Locking Vault</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="locking-vault">Locking Vault</h1>
<ul>
<li><strong>Contract Name:</strong> LockingVault.sol</li>
<li><strong>Type/Category:</strong> Voting Vault/Governance </li>
<li><strong>Contract Source:</strong> <a href="https://github.com/element-fi/council/blob/main/contracts/vaults/LockingVault.sol" target="_blank">https://github.com/element-fi/council/blob/main/contracts/vaults/LockingVault.sol</a></li>
</ul>
<h2 id="1-introduction-summary"><strong>1. Introduction (Summary)</strong></h2>
<p>The Locking vault is a contract that allows the DAO to allocate votes to the token holders. It works by having the holders of the token deposit them into the Locking Vault. After votes have been allocated to users, they can then delegate votes to other addresses to vote on their behalf. To use their tokens in other contexts, the users must withdraw them from the locking vault.</p>
<h2 id="2-contract-details"><strong>2. </strong>Contract Details</h2>
<h4 id="key-functionalities-">Key Functionalities: </h4>
<ul>
<li>Users can deposit into the locking vault and then either be allocated votes or have their votes be delegated to another address. </li>
<li>Users can change which address their votes are delegated to. </li>
<li>Users can withdraw their tokens to move them back into their wallets. </li>
<li>The core voting contract can query the LockingVault to check the historical voting power of users in it. </li>
</ul>
<h4 id="storage-layout-">Storage Layout: </h4>
<ul>
<li>A system of state which tracks the historical power of addresses using the logic of the History.sol library. </li>
<li>A mapping that tracks a user&apos;s deposited amount and who they have delegated to. </li>
<li>Configuration parameters such as the token used and how much voting power history to retain.</li>
</ul>
<h2 id="3-key-mechanisms--concepts">3. Key Mechanisms &amp; Concepts</h2>
<p>The Council DAO framework can allocate votes to multiple sources but cannot employ the Compound governance contracts technique that tracks voting power inside the ERC20 itself. Therefore, for a user to have their voting power recognized, they must deposit into the voting contracts. This contract enables a user to deposit their tokens and receive voting power. When they deposit, they are allowed to select an address that may vote with their voting power. Each address has a historical tracker of voting power indexed by block number, and when they deposit or are delegated to the historical tracker records this. The core voting contract then calls the locking vault to ask how many votes an address has when a user votes on a proposal.</p>
<h2 id="4-gotchas-potential-source-of-user-error">4. Gotchas (Potential source of user error)</h2>
<ul>
<li>A user can fund another user&apos;s account and, on deposit, select the first delegation address. The &apos;firstDelegation&apos; field in the call after the first call is ignored. </li>
<li>If a malicious actor deposits to another user&apos;s address before that user deposits, then that malicious actor can select the delegation for the user. If the user deposits, they should confirm they have not been front run and, if they have, they must change delegation. </li>
<li>Vote power queries will revert for users who have never been deposited or delegated to.</li>
</ul>
<h2 id="5-failure-modes-bounds-on-operating-conditions--external-risk-factors">5. Failure Modes (Bounds on Operating Conditions &amp; External Risk Factors)</h2>
<ul>
<li>The Locking Vault contract is intended to be used as the logic contract for an upgradable proxy, and it is recommended that it be only used in this context. </li>
<li>Since the Locking Vault is upgradable, its funds have the same risk profile as the governance system as a whole. </li>
<li>In the case of a bug, the governance system should upgrade the locking proxy to protect user funds. However, because the locking vault is a primary source of funds, certain critical bugs may compromise its ability to do so.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Voting Vaults">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="vesting-vault.html" class="navigation navigation-next " aria-label="Next page: Vesting Vault">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Locking Vault","level":"5.1.2.1","depth":3,"next":{"title":"Vesting Vault","level":"5.1.2.2","depth":3,"path":"governance-council/council-protocol-smart-contracts/voting-vaults/vesting-vault.md","ref":"governance-council/council-protocol-smart-contracts/voting-vaults/vesting-vault.md","articles":[]},"previous":{"title":"Voting Vaults","level":"5.1.2","depth":2,"path":"governance-council/council-protocol-smart-contracts/voting-vaults/README.md","ref":"governance-council/council-protocol-smart-contracts/voting-vaults/README.md","articles":[{"title":"Locking Vault","level":"5.1.2.1","depth":3,"path":"governance-council/council-protocol-smart-contracts/voting-vaults/locking-vault.md","ref":"governance-council/council-protocol-smart-contracts/voting-vaults/locking-vault.md","articles":[]},{"title":"Vesting Vault","level":"5.1.2.2","depth":3,"path":"governance-council/council-protocol-smart-contracts/voting-vaults/vesting-vault.md","ref":"governance-council/council-protocol-smart-contracts/voting-vaults/vesting-vault.md","articles":[]},{"title":"Governance Steering Council (GSC) Vault","level":"5.1.2.3","depth":3,"path":"governance-council/council-protocol-smart-contracts/voting-vaults/governance-steering-council-gsc-vault.md","ref":"governance-council/council-protocol-smart-contracts/voting-vaults/governance-steering-council-gsc-vault.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"governance-council/council-protocol-smart-contracts/voting-vaults/locking-vault.md","mtime":"2022-03-29T09:16:39.372Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-03-29T09:24:36.351Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

